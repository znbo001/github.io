<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全新值班安排管理系统</title>
    <!-- 引入外部资源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',    // 主色调：蓝色
                        secondary: '#F59E0B',  // 辅助色：橙色
                        'shift-morning': '#DBEAFE', // 早班背景色
                        'shift-afternoon': '#FDE68A', // 晚班背景色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto { content-visibility: auto; }
            .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
            .calendar-day-hover { transition: all 0.2s ease-in-out; }
            .calendar-day-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- 页面标题 -->
        <header class="mb-8 text-center">
            <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-gray-900 mb-2">值班安排管理系统</h1>
            <p class="text-gray-600">高效管理团队值班，一目了然</p>
        </header>

        <!-- 主要内容区 -->
        <main class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <!-- 侧边栏：今日/明日值班信息 -->
            <aside class="md:col-span-1">
                <div class="bg-white rounded-xl card-shadow p-6 sticky top-6">
                    <h2 class="text-xl font-bold mb-6 pb-3 border-b border-gray-200">近期值班</h2>
                    
                    <!-- 今日值班和明日值班 - 横向布局 -->
                    <div class="flex flex-row gap-4">
                        <!-- 今日值班 -->
                        <div id="today-duty" class="flex-1 min-w-0">
                            <div class="flex items-center mb-3">
                                <i class="fa fa-sun-o text-primary text-xl mr-2"></i>
                                <h3 class="text-lg font-semibold">今日值班</h3>
                            </div>
                            <div id="today-duty-content" class="space-y-2">
                                <!-- 内容由JS动态生成 -->
                            </div>
                        </div>
                        
                        <!-- 明日值班 -->
                        <div id="tomorrow-duty" class="flex-1 min-w-0">
                            <div class="flex items-center mb-3">
                                <i class="fa fa-moon-o text-secondary text-xl mr-2"></i>
                                <h3 class="text-lg font-semibold">明日值班</h3>
                            </div>
                            <div id="tomorrow-duty-content" class="space-y-2">
                                <!-- 内容由JS动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 主区域：日历 -->
            <div class="md:col-span-3">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <!-- 日历头部：月份导航 -->
                    <div class="flex justify-between items-center mb-6">
                        <button id="prev-month" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                            <i class="fa fa-chevron-left text-lg"></i>
                        </button>
                        <h2 id="current-month-display" class="text-2xl font-bold">2025年11月</h2>
                        <button id="next-month" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                            <i class="fa fa-chevron-right text-lg"></i>
                        </button>
                    </div>
                    
                    <!-- 日历星期标题 -->
                    <div class="grid grid-cols-7 gap-1 mb-2">
                        <div class="text-center font-semibold text-gray-500 py-2">周日</div>
                        <div class="text-center font-semibold text-primary py-2 bg-blue-50">周一</div>
                        <div class="text-center font-semibold text-gray-500 py-2">周二</div>
                        <div class="text-center font-semibold text-gray-500 py-2">周三</div>
                        <div class="text-center font-semibold text-gray-500 py-2">周四</div>
                        <div class="text-center font-semibold text-gray-500 py-2">周五</div>
                        <div class="text-center font-semibold text-gray-500 py-2">周六</div>
                    </div>
                    
                    <!-- 日历网格 -->
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1">
                        <!-- 日历单元格由JS动态生成 -->
                    </div>
                </div>
            </div>
        </main>

        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>© 2025 值班安排管理系统 | 最后更新: <span id="last-updated">2025年11月22日 12:00</span></p>
        </footer>
    </div>

    <script>
        // 1. 业务数据与配置
        // 值班顺序：赵予 → 张宁勃 → 刘倚石 → 陈琛 → 薛春梅&徐斌
        const DUTY_ROSTER = [
            { name: "赵予", color: "bg-blue-100 text-blue-800" },
            { name: "张宁勃", color: "bg-purple-100 text-purple-800" },
            { name: "刘倚石", color: "bg-green-100 text-green-800" },
            { name: "陈琛", color: "bg-yellow-100 text-yellow-800" },
            { 
                name: "薛春梅", 
                color: "bg-red-100 text-red-800",
                isPair: true,
                pairName: "徐斌",
                pairColor: "bg-indigo-100 text-indigo-800"
            }
        ];
        const FIXED_PERSON_FOR_MONDAY = { name: "张慧杰", color: "bg-primary/10 text-primary" };
        // 参考日期：2025年11月25日，已知值班人员为刘倚石 (索引为 2)
        const REFERENCE_DATE = new Date(2025, 10, 25); // 10 代表 11月

        // 2. 全局状态
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // 3. DOM 元素
        const elements = {
            calendarGrid: document.getElementById('calendar-grid'),
            currentMonthDisplay: document.getElementById('current-month-display'),
            prevMonthBtn: document.getElementById('prev-month'),
            nextMonthBtn: document.getElementById('next-month'),
            todayDutyContent: document.getElementById('today-duty-content'),
            tomorrowDutyContent: document.getElementById('tomorrow-duty-content'),
            lastUpdated: document.getElementById('last-updated')
        };

        // 4. 工具函数
        /**
         * 计算两个日期之间的非周一的天数差
         * @param {Date} startDate - 开始日期
         * @param {Date} endDate - 结束日期
         * @returns {number} - 天数差，如果endDate在startDate之前，返回负数
         */
        function getNonMondayDayDifference(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            start.setHours(0, 0, 0, 0);
            end.setHours(0, 0, 0, 0);

            let diffDays = 0;
            const direction = end > start ? 1 : -1;

            while (start.getTime() !== end.getTime()) {
                start.setDate(start.getDate() + direction);
                if (start.getDay() !== 1) { // 跳过周一
                    diffDays += direction;
                }
            }
            return diffDays;
        }
        
        /**
         * 获取指定日期的值班人员
         * @param {Date} date - 指定日期
         * @returns {Object} - 值班人员信息
         */
        function getDutyPerson(date) {
            const day = date.getDay();

            // 周一固定张慧杰
            if (day === 1) {
                return FIXED_PERSON_FOR_MONDAY;
            }
            
            // 计算从参考日期到目标日期的非周一的天数差
            const diff = getNonMondayDayDifference(REFERENCE_DATE, date);
            
            // 刘倚石在值班列表中的索引为 2
            const referenceIndex = 2; 
            
            // 根据差值计算目标索引，确保循环正确
            let targetIndex = (referenceIndex + diff) % DUTY_ROSTER.length;
            
            // 处理负数索引的情况
            if (targetIndex < 0) {
                targetIndex += DUTY_ROSTER.length;
            }

            return DUTY_ROSTER[targetIndex];
        }

        /**
         * 渲染单个日历单元格
         * @param {number} day - 日期
         * @param {number} month - 月份 (0-11)
         * @param {number} year - 年份
         * @param {boolean} isCurrentMonth - 是否是当前显示的月份
         */
        function renderCalendarCell(day, month, year, isCurrentMonth) {
            const cell = document.createElement('div');
            const date = new Date(year, month, day);
            const isToday = date.toDateString() === new Date().toDateString();
            const dutyPerson = getDutyPerson(date);

            let cellClasses = "rounded-lg p-2 min-h-[120px] calendar-day-hover border ";
            if (!isCurrentMonth) cellClasses += "bg-gray-50 text-gray-400 border-gray-200";
            else if (date.getDay() === 0) cellClasses += "border-gray-200"; // 周日
            else if (date.getDay() === 1) cellClasses += "border-primary/20 bg-blue-50"; // 周一
            else cellClasses += "border-gray-200";
            
            if (isToday) cellClasses += " ring-2 ring-primary";

            cell.className = cellClasses;

            let cellContent = `<div class="text-right text-lg font-bold mb-2 ${isToday ? 'text-primary' : ''}">${day}</div>`;
            
            if (dutyPerson) {
                if (dutyPerson.isPair) {
                    cellContent += `
                        <div class="text-sm font-medium p-1 rounded ${dutyPerson.color} mb-1">
                            ${dutyPerson.name} <span class="text-xs font-normal bg-white/50 rounded-full px-1 ml-1">早到</span>
                        </div>
                        <div class="text-sm font-medium p-1 rounded ${dutyPerson.pairColor}">
                            ${dutyPerson.pairName} <span class="text-xs font-normal bg-white/50 rounded-full px-1 ml-1">晚走</span>
                        </div>
                    `;
                } else {
                    cellContent += `
                        <div class="text-sm font-medium p-1 rounded ${dutyPerson.color}">
                            ${dutyPerson.name}
                        </div>
                    `;
                }
            }

            cell.innerHTML = cellContent;
            return cell;
        }

        /**
         * 渲染整个日历
         */
        function renderCalendar() {
            elements.calendarGrid.innerHTML = '';

            const monthNames = ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十一月", "十二月"];
            elements.currentMonthDisplay.textContent = `${currentYear}年${monthNames[currentMonth]}`;

            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const firstDayOfWeek = firstDay.getDay();

            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            for (let i = firstDayOfWeek; i > 0; i--) {
                elements.calendarGrid.appendChild(renderCalendarCell(prevMonthLastDay - i + 1, currentMonth - 1, currentYear, false));
            }

            for (let i = 1; i <= lastDay.getDate(); i++) {
                elements.calendarGrid.appendChild(renderCalendarCell(i, currentMonth, currentYear, true));
            }

            const nextMonthDaysToAdd = 42 - (firstDayOfWeek + lastDay.getDate());
            for (let i = 1; i <= nextMonthDaysToAdd; i++) {
                elements.calendarGrid.appendChild(renderCalendarCell(i, currentMonth + 1, currentYear, false));
            }

            elements.lastUpdated.textContent = new Date().toLocaleString('zh-CN', { 
                year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' 
            });
        }

        /**
         * 渲染今日/明日值班信息
         */
        function renderRecentDuty() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);

            const renderDuty = (container, person) => {
                container.innerHTML = '';
                if (person) {
                    if (person.isPair) {
                        container.innerHTML = `
                            <div class="p-2 rounded-lg ${person.color} font-medium text-sm">${person.name} <span class="text-xs bg-white/50 rounded px-1">早</span></div>
                            <div class="p-2 rounded-lg ${person.pairColor} font-medium text-sm">${person.pairName} <span class="text-xs bg-white/50 rounded px-1">晚</span></div>
                        `;
                    } else {
                        container.innerHTML = `<div class="p-2 rounded-lg ${person.color} font-medium text-sm">${person.name}</div>`;
                    }
                }
            };

            renderDuty(elements.todayDutyContent, getDutyPerson(today));
            renderDuty(elements.tomorrowDutyContent, getDutyPerson(tomorrow));
        }

        // 5. 事件监听
        function setupEventListeners() {
            elements.prevMonthBtn.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                renderCalendar();
            });

            elements.nextMonthBtn.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                renderCalendar();
            });
        }

        // 6. 初始化应用
        function initApp() {
            renderCalendar();
            renderRecentDuty();
            setupEventListeners();
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
